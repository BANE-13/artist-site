<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Login</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #E9DDFF, #CDBBFF);
}

.box {
  width: 320px;
  margin: 100px auto;
  background: white;
  padding: 20px;
  border-radius: 12px;
}

input, button {
  width: 100%;
  margin-top: 10px;
  padding: 10px;
}
</style>
</head>

<body>

<div class="box">
  <h2>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h2>

  <input id="email" placeholder="ê°€ìƒ ì´ë©”ì¼">
  <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <input id="name" placeholder="ì´ë¦„ (íšŒì›ê°€ì…ìš©)">
  <input id="artistCode" placeholder="ì•„í‹°ìŠ¤íŠ¸ ê°€ì…ë²ˆí˜¸">

  <button onclick="signup()">íšŒì›ê°€ì…</button>
  <button onclick="login()">ë¡œê·¸ì¸</button>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore, doc, setDoc, getDocs, collection, query, where
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ğŸ”¥ ì—¬ê¸°ì— Firebase ì½˜ì†” ê°’ ë¶™ì—¬ë„£ê¸° */
const firebaseConfig = {
  apiKey: "ì—¬ê¸°ì—",
  authDomain: "ì—¬ê¸°ì—",
  projectId: "ì—¬ê¸°ì—",
  appId: "ì—¬ê¸°ì—"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

const ARTIST_CODE = "gkwlsrla00!";

/* íšŒì›ê°€ì… */
window.signup = async function () {
  const email = email.value;
  const password = password.value;
  const nameValue = name.value;
  const code = artistCode.value;

  const isArtist = code === ARTIST_CODE;

  if (!isArtist) {
    const q = query(collection(db, "users"), where("name", "==", nameValue));
    const snap = await getDocs(q);
    if (!snap.empty) {
      alert("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë¦„ì…ë‹ˆë‹¤.");
      return;
    }
  }

  const user = await createUserWithEmailAndPassword(auth, email, password);

  await setDoc(doc(db, "users", user.user.uid), {
    name: nameValue,
    role: isArtist ? "artist" : "fan"
  });

  location.href = "main.html";
};

/* ë¡œê·¸ì¸ */
window.login = async function () {
  await signInWithEmailAndPassword(auth, email.value, password.value);
  location.href = "main.html";
};
</script>

</body>
</html>
